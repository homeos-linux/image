#!/bin/bash
# GUI Docker setup script using pkexec

# Check if user is already in docker group
if groups | grep -q docker; then
    zenity --info --title="Docker Setup" --text="You already have Docker access!" 2>/dev/null || {
        notify-send "Docker Setup" "You already have Docker access!"
    }
    exit 0
fi

# Ask user if they want to set up Docker
if zenity --question --title="Docker Setup" --text="Would you like to set up Docker access for your user account?\n\nThis will add you to the docker group and requires administrator privileges." 2>/dev/null; then
    # Use pkexec to add user to docker group
    if pkexec usermod -aG docker "$USER"; then
        zenity --info --title="Docker Setup Complete" --text="You have been added to the docker group!\n\nPlease log out and log back in for the changes to take effect." 2>/dev/null || {
            notify-send "Docker Setup Complete" "Please log out and log back in for Docker access."
        }
    else
        zenity --error --title="Docker Setup Failed" --text="Failed to add user to docker group.\n\nPlease run manually: sudo usermod -aG docker $USER" 2>/dev/null || {
            notify-send "Docker Setup Failed" "Run: sudo usermod -aG docker $USER"
        }
    fi
else
    echo "Docker setup cancelled by user"
fi