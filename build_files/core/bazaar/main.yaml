# homeOS Bazaar Main Configuration
# This file defines hooks and advanced behavior for Bazaar

hooks:
  - id: jetbrains-warning
    when: before-transaction
    dialogs:
      - id: jetbrains-dialog
        title: "JetBrains IDEs - Alternative Recommendation"
        body-use-markup: true
        body: |
          <b>JetBrains IDEs</b> are not officially supported as Flatpaks and may have issues.
          
          For the best experience, we recommend using:
          â€¢ <a href="https://www.jetbrains.com/toolbox-app/">JetBrains Toolbox</a> (official installer)
          â€¢ Native RPM packages when available
          â€¢ <b>GNOME Builder</b> for a great native development experience
          
          Would you like to continue with this installation anyway?
        default-response-id: cancel
        options:
          - id: cancel
            string: "Cancel Installation"
            style: suggested
          - id: toolbox
            string: "Get JetBrains Toolbox"
            style: suggested
          - id: continue
            string: "Install Anyway"
            style: destructive
    shell: |
      case "$BAZAAR_HOOK_STAGE" in
          setup)
              if [ "$BAZAAR_TS_TYPE" = "install" ]; then
                  case "$BAZAAR_TS_APPID" in
                      com.jetbrains.*)
                          echo 'ok' ;;
                      *) echo 'pass' ;;
                  esac
              else
                  echo 'pass'
              fi
              ;;
          setup-dialog)
              echo 'ok'
              ;;
          teardown-dialog)
              case "$BAZAAR_HOOK_DIALOG_RESPONSE_ID" in
                  toolbox)
                      echo 'ok' ;;
                  continue)
                      echo 'ok' ;;
                  *)
                      echo 'abort' ;;
              esac
              ;;
          catch)
              echo 'abort'
              ;;
          action)
              if [ "$BAZAAR_HOOK_DIALOG_RESPONSE_ID" = "toolbox" ]; then
                  nohup xdg-open 'https://www.jetbrains.com/toolbox-app/' >/dev/null 2>&1 &
              fi
              ;;
          teardown)
              case "$BAZAAR_HOOK_DIALOG_RESPONSE_ID" in
                  toolbox)
                      echo 'deny' ;;
                  continue)
                      echo 'confirm' ;;
                  *)
                      echo 'deny' ;;
              esac
              ;;
      esac

  - id: development-alternatives
    when: before-transaction
    dialogs:
      - id: vscode-dialog
        title: "Development Environment Recommendation"
        body-use-markup: true
        body: |
          <b>VS Code</b> and similar editors are available, but for the best homeOS experience, consider:
          
          â€¢ <b>GNOME Builder</b> - Native GNOME development environment
          â€¢ <b>Text Editor</b> - Modern, fast editing with syntax highlighting
          â€¢ <b>Workbench</b> - Learn and prototype with GTK4/Libadwaita
          
          Would you like to explore these alternatives or continue with your choice?
        default-response-id: continue
        options:
          - id: alternatives
            string: "Show Alternatives"
            style: suggested
          - id: continue
            string: "Continue with Installation"
    shell: |
      case "$BAZAAR_HOOK_STAGE" in
          setup)
              if [ "$BAZAAR_TS_TYPE" = "install" ]; then
                  case "$BAZAAR_TS_APPID" in
                      com.visualstudio.code|com.visualstudio.code-oss|com.vscodium.codium)
                          echo 'ok' ;;
                      *) echo 'pass' ;;
                  esac
              else
                  echo 'pass'
              fi
              ;;
          setup-dialog)
              echo 'ok'
              ;;
          teardown-dialog)
              echo 'ok'
              ;;
          catch)
              echo 'abort'
              ;;
          action)
              if [ "$BAZAAR_HOOK_DIALOG_RESPONSE_ID" = "alternatives" ]; then
                  # This could open Bazaar to show development apps
                  nohup bazaar window >/dev/null 2>&1 &
              fi
              ;;
          teardown)
              echo 'confirm'
              ;;
      esac

  - id: welcome-to-homeos
    when: after-transaction
    dialogs:
      - id: welcome-dialog
        title: "Welcome to homeOS!"
        body-use-markup: true
        body: |
          ðŸŽ‰ <b>Installation Complete!</b>
          
          Your new application has been installed successfully. 
          
          <b>Tip:</b> homeOS applications are sandboxed for security and update automatically for the best experience.
          
          Enjoy using your new app!
        default-response-id: ok
        options:
          - id: ok
            string: "Great!"
            style: suggested
    shell: |
      case "$BAZAAR_HOOK_STAGE" in
          setup)
              # Only show welcome for first few installations
              if [ "$BAZAAR_TS_TYPE" = "install" ] && [ ! -f "$HOME/.config/homeos-bazaar-welcomed" ]; then
                  echo 'ok'
              else
                  echo 'pass'
              fi
              ;;
          setup-dialog)
              echo 'ok'
              ;;
          teardown-dialog)
              echo 'ok'
              ;;
          catch)
              echo 'abort'
              ;;
          action)
              # Mark that we've shown the welcome
              mkdir -p "$HOME/.config"
              touch "$HOME/.config/homeos-bazaar-welcomed"
              ;;
          teardown)
              echo 'continue'
              ;;
      esac